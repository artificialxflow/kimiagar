# پروژه کیمیاگر - لیست کارها

## 🎯 مشخصات پروژه
- **نام:** کیمیاگر (Kimiagar)
- **نوع:** پلتفرم مدیریت طلا و کیف پول دیجیتال
- **زبان:** فارسی (RTL)
- **فریم‌ورک:** Next.js 13+ با App Router
- **دیتابیس:** PostgreSQL (Remote Server)
- **ORM:** Prisma
- **استایل:** Tailwind CSS + Vazirmatn Font

## 🎨 رنگ‌بندی و تم
- **رنگ اصلی:** طلایی (#D4AF37)
- **رنگ ثانویه:** خاکستری تیره (#1e293b)
- **رنگ پس‌زمینه:** سفید (#ffffff)
- **رنگ متن:** خاکستری تیره (#334155)
- **فونت:** Vazirmatn (فونت فارسی)

## ✅ کارهای انجام شده

### Frontend
- [x] تمیز کردن پروژه Next.js
- [x] نصب و تنظیم Tailwind CSS
- [x] راست‌چین کردن پروژه (RTL)
- [x] نصب فونت Vazirmatn
- [x] کپی کردن کامپوننت‌ها از React به Next.js
- [x] تبدیل React Router به Next.js App Router
- [x] اضافه کردن "use client" به کامپوننت‌های کلاینت
- [x] ایجاد صفحات اصلی (dashboard, wallet, trading, login)
- [x] طراحی و جایگذاری favicon سفارشی
- [x] ~~بهبود فرم ورود با 5 مرحله (شماره موبایل، OTP، کد ملی، شماره شبا، کد پستی)~~ **تغییر به سیستم ورود با یوزرنیم/پسورد**
- [x] ریدایرکت از صفحه اصلی به صفحه ورود
- [x] اتصال کامپوننت‌های Frontend به API Routes
- [x] مدیریت state و loading در کامپوننت‌ها
- [x] نمایش اطلاعات واقعی در داشبورد
- [x] اتصال فرم‌های خرید و فروش به API
- [x] اتصال فرم‌های واریز و برداشت به API
- [x] بهبود UX و UI کامپوننت‌ها

### Backend
- [x] تصمیم‌گیری برای استفاده از PostgreSQL
- [x] نصب Prisma ORM
- [x] طراحی مدل‌های دیتابیس (User, Wallet, Transaction, Order, Price, Commission, SystemSetting)
- [x] اجرای migration و ایجاد جداول
- [x] ایجاد API Routes:
  - [x] `/api/auth/register` - ثبت‌نام کاربران
  - [ ] `/api/auth/login` - ورود کاربران (یوزرنیم/پسورد)
  - [x] `/api/wallet/balance` - دریافت موجودی کیف پول
  - [x] `/api/prices` - مدیریت قیمت‌های لحظه‌ای
  - [x] `/api/wallet/deposit` - واریز به کیف پول
  - [x] `/api/wallet/withdraw` - برداشت از کیف پول
  - [x] `/api/trading/buy` - ثبت سفارش خرید
  - [x] `/api/trading/sell` - ثبت سفارش فروش
  - [x] `/api/transactions` - تاریخچه تراکنش‌ها
  - [x] `/api/debug/users` - نمایش کاربران (برای debug)

### Database
- [x] اتصال به PostgreSQL سرور راه دور
- [x] ایجاد جداول اصلی
- [x] تنظیم روابط بین جداول
- [x] تعریف Enum ها برای انواع مختلف
- [x] تست اتصال و ذخیره‌سازی داده‌ها

## 🔄 کارهای در حال انجام
- [x] اعتبارسنجی فرم‌ها (Validation)
- [x] بهبود فرم ثبت‌نام (نام و نام خانوادگی)
- [x] اضافه کردن منوی ناوبری
- [x] ایجاد صفحه پروفایل
- [x] Dockerize کردن پروژه
- [x] **تغییر سیستم ورود به یوزرنیم/پسورد**
- [x] **اضافه کردن فیلدهای تکمیلی در پروفایل**
- [ ] بهبود UX و UI

## 📋 کارهای باقی‌مانده

### Validation & UX Improvements
- [x] اعتبارسنجی شماره موبایل (11 رقم)
- [x] اعتبارسنجی کد ملی (10 رقم)
- [x] اعتبارسنجی شماره شبا (24 کاراکتر)
- [x] اعتبارسنجی کد پستی (10 رقم)
- [x] اضافه کردن فیلدهای نام و نام خانوادگی به فرم ثبت‌نام
- [x] نمایش نام کاربر در داشبورد
- [x] اضافه کردن منوی ناوبری (Navigation Menu)
- [x] بهبود پیام‌های خطا و موفقیت
- [x] **اعتبارسنجی یوزرنیم و پسورد**
- [x] **انتقال فیلدهای تکمیلی به پروفایل**

### Pages & Features
- [x] **صفحه انتقال (Transfer)** - انتقال بین کیف پول‌ها
- [x] **صفحه گزارش‌گیری** - گزارش‌های مالی
- [x] **صفحه تنظیمات** - تنظیمات کاربری
- [x] **صفحه اعلان‌ها** - مدیریت اعلان‌ها

### API Routes
- [x] `/api/profile/update` - به‌روزرسانی پروفایل
- [x] `/api/health` - Health Check برای Docker
- [x] `/api/auth/login` - ورود کاربران (یوزرنیم/پسورد)
- [x] `/api/auth/register` - ثبت‌نام با یوزرنیم/پسورد
- [x] `/api/transfer` - انتقال بین کیف پول‌ها
- [x] `/api/orders` - مدیریت سفارش‌ها
- [x] `/api/commissions` - مدیریت کارمزدها
- [x] `/api/notifications` - مدیریت اعلان‌ها
- [x] `/api/reports` - تولید گزارش‌های مالی
- [x] `/api/settings` - مدیریت تنظیمات کاربری
- [x] `/api/admin/stats` - آمار ادمین
- [x] `/api/admin/users` - مدیریت کاربران
- [x] `/api/admin/orders` - مدیریت سفارش‌ها

### Frontend Integration
- [ ] اتصال کامپوننت‌های باقی‌مانده
- [ ] بهبود UX و UI
- [ ] اضافه کردن loading states
- [ ] مدیریت خطاها

### Security & Validation
- [ ] اعتبارسنجی ورودی‌ها
- [ ] مدیریت خطاها
- [ ] Rate limiting
- [ ] CORS configuration
- [ ] JWT authentication
- [ ] **Hash کردن پسوردها**
- [ ] **Session management**

### Features
- [x] سیستم اعلان‌ها
- [ ] نمودار قیمت‌ها (بهبود)
- [x] گزارش‌گیری
- [x] پنل ادمین
- [ ] API برای دریافت قیمت‌های خارجی

### Deployment
- [x] Dockerfile آماده
- [x] docker-compose.yml آماده
- [x] Health Check API
- [x] Environment Variables
- [x] Production Build Configuration
- [ ] Database backup
- [ ] Monitoring

## 🗄️ مشخصات دیتابیس

### تصمیم نهایی: PostgreSQL
**دلیل انتخاب:**
- ACID compliance برای تراکنش‌های مالی
- پشتیبانی از JSON برای داده‌های پیچیده
- Performance بالا برای خواندن/نوشتن
- امنیت بالا
- پشتیبانی از Foreign Keys و Constraints

### اتصال به دیتابیس راه دور
```env
DATABASE_URL="postgresql://root:ANG5guAtXXLBvOLKJ7vqnAk2@tirich-mir.liara.cloud:32252/postgres"
```

### جداول ایجاد شده:
1. **users** - اطلاعات کاربران ✅
2. **wallets** - کیف پول‌های ریالی و طلایی ✅
3. **transactions** - تراکنش‌های مالی ✅
4. **orders** - سفارش‌های خرید و فروش ✅
5. **prices** - قیمت‌های لحظه‌ای ✅
6. **commissions** - تنظیمات کارمزد
7. **system_settings** - تنظیمات سیستم

## 🚀 مراحل بعدی
1. **صفحه انتقال** - ایجاد صفحه transfer ✅
2. **تغییر سیستم ورود** - تبدیل به یوزرنیم/پسورد ✅
3. **بهبود پروفایل** - اضافه کردن فیلدهای تکمیلی ✅
4. **سیستم اعلان‌ها** - مدیریت اعلان‌ها ✅
5. **گزارش‌گیری** - گزارش‌های مالی ✅
6. **تنظیمات کاربری** - مدیریت تنظیمات ✅
7. **پنل ادمین** - مدیریت سیستم ✅
8. **مدیریت سفارش‌ها** - API کامل ✅
9. **مدیریت کارمزدها** - سیستم کارمزد ✅
10. **اعتبارسنجی و UX** - بهبود فرم‌ها و validation
11. **بهینه‌سازی** - Performance و UX
12. **امنیت** - JWT و validation
13. **Deployment** - راه‌اندازی در production

## 🧪 تست‌های انجام شده
- [x] ثبت‌نام کاربر ✅
- [x] ذخیره در دیتابیس ✅
- [x] نمایش در داشبورد ✅
- [x] دریافت قیمت‌ها ✅
- [x] واریز به کیف پول ✅
- [x] خرید طلا ✅
- [x] فروش طلا ✅
- [x] برداشت از کیف پول ✅
- [x] تاریخچه تراکنش‌ها ✅
- [x] **ورود با یوزرنیم/پسورد** ✅
- [x] **به‌روزرسانی پروفایل** ✅
- [x] **انتقال بین کیف پول‌ها** ✅
- [x] **سیستم اعلان‌ها** ✅
- [x] **گزارش‌گیری مالی** ✅
- [x] **تنظیمات کاربری** ✅
- [x] **پنل ادمین** ✅
- [x] **مدیریت سفارش‌ها** ✅
- [x] **مدیریت کارمزدها** ✅

## 🎯 قابلیت‌های تکمیل شده
- ✅ **سیستم ثبت‌نام و ورود (یوزرنیم/پسورد)**
- ✅ **مدیریت کیف پول (واریز/برداشت)**
- ✅ **خرید و فروش طلا/سکه**
- ✅ **نمایش موجودی و تراکنش‌ها**
- ✅ **قیمت‌های لحظه‌ای**
- ✅ **تاریخچه کامل تراکنش‌ها**
- ✅ **بهبود سیستم ورود و پروفایل**
- ✅ **انتقال بین کیف پول‌ها**
- ✅ **سیستم اعلان‌ها**
- ✅ **گزارش‌گیری مالی**
- ✅ **تنظیمات کاربری**
- ✅ **پنل ادمین**
- ✅ **مدیریت سفارش‌ها**
- ✅ **مدیریت کارمزدها**

## 🔒 بهبودهای امنیتی پیشنهادی

### JWT Authentication
- [x] نصب `jsonwebtoken`
- [x] ایجاد middleware برای JWT verification
- [x] تغییر localStorage به httpOnly cookies
- [x] اضافه کردن refresh tokens

### اعتبارسنجی قوی‌تر
- [ ] اعتبارسنجی پیچیده رمز عبور (حروف بزرگ، کوچک، اعداد، کاراکترهای خاص)
- [ ] محدودیت طول نام کاربری (حداکثر 20 کاراکتر)
- [ ] فیلتر کردن کاراکترهای غیرمجاز در نام کاربری

### Rate Limiting
- [ ] محدودیت 5 درخواست در دقیقه برای ورود
- [ ] محدودیت 3 درخواست در دقیقه برای ثبت‌نام
- [ ] Block کردن IP بعد از 10 تلاش ناموفق

### امنیت اضافی
- [ ] CSRF Protection
- [ ] Helmet.js برای HTTP headers
- [ ] Logging مناسب برای audit trail
- [ ] دو مرحله‌ای کردن ورود (2FA)

---
**آخرین به‌روزرسانی:** 22 تیر 1403
**وضعیت:** سیستم کامل کار می‌کند، تمام قابلیت‌های اصلی پیاده‌سازی شده‌اند شامل سیستم اعلان‌ها، گزارش‌گیری، تنظیمات، پنل ادمین و مدیریت کامل سفارش‌ها و کارمزدها 

## 🔗 اتصال به API قیمت‌های خارجی (Yazdan Gold Price Bot)

### 📋 چک لیست کارهای لازم:

#### **1. تنظیمات اولیه**
- [ ] اضافه کردن متغیر محیطی `EXTERNAL_PRICE_API_URL` در `.env.local`
- [ ] اضافه کردن متغیر محیطی `EXTERNAL_PRICE_API_URL` در Liara Environment Variables
- [ ] ایجاد فایل `app/lib/externalPriceService.ts` برای مدیریت API calls

#### **2. ایجاد Service برای API خارجی**
- [ ] تابع `getExternalPrices()` برای دریافت قیمت‌ها از `/api/prices`
- [ ] تابع `scrapeExternalPrices()` برای اسکرپ قیمت‌های جدید از `/api/scrape`
- [ ] تابع `getExternalPriceStatus()` برای بررسی وضعیت از `/api/status`
- [ ] تابع `checkExternalAPIHealth()` برای health check از `/health`
- [ ] مدیریت خطاها و retry logic
- [ ] اضافه کردن TypeScript interfaces برای response types

#### **3. بروزرسانی API Routes موجود**
- [ ] بروزرسانی `/api/prices` برای ترکیب قیمت‌های داخلی و خارجی
- [ ] اضافه کردن endpoint جدید `/api/prices/external` برای دریافت فقط قیمت‌های خارجی
- [ ] اضافه کردن endpoint جدید `/api/prices/combined` برای دریافت همه قیمت‌ها
- [ ] بروزرسانی response format برای سازگاری با ساختار موجود

#### **4. بروزرسانی کامپوننت‌های Frontend**
- [ ] بروزرسانی `PriceCard.tsx` برای نمایش قیمت‌های خارجی
- [ ] بروزرسانی `PriceChart.tsx` برای نمودار قیمت‌های ترکیبی
- [ ] بروزرسانی `Dashboard.tsx` برای نمایش آخرین قیمت‌های خارجی
- [ ] اضافه کردن loading states برای API calls خارجی
- [ ] اضافه کردن error handling برای API calls خارجی

#### **5. مدیریت State و Cache**
- [ ] ایجاد context یا store برای مدیریت قیمت‌های خارجی
- [ ] پیاده‌سازی auto-refresh هر 5 دقیقه
- [ ] ذخیره‌سازی موقت قیمت‌ها در localStorage
- [ ] مدیریت وضعیت loading و error در UI

#### **6. بهبود UX**
- [ ] نمایش timestamp آخرین بروزرسانی قیمت‌ها
- [ ] نمایش منبع قیمت (داخلی/خارجی)
- [ ] امکان refresh دستی قیمت‌ها
- [ ] نمایش وضعیت اتصال به API خارجی
- [ ] پیام‌های مناسب برای خطاهای اتصال

#### **7. تست و Validation**
- [ ] تست اتصال به API خارجی
- [ ] تست دریافت و نمایش قیمت‌ها
- [ ] تست error handling
- [ ] تست performance با قیمت‌های زیاد
- [ ] تست در محیط production

#### **8. بهینه‌سازی**
- [ ] پیاده‌سازی debouncing برای API calls
- [ ] اضافه کردن retry mechanism
- [ ] مدیریت rate limiting (100 requests per 15 minutes)
- [ ] بهینه‌سازی bundle size

#### **9. مستندسازی**
- [ ] بروزرسانی API documentation
- [ ] اضافه کردن JSDoc برای توابع جدید
- [ ] ایجاد README برای نحوه استفاده از API خارجی
- [ ] مستندسازی error codes و messages

#### **10. Monitoring و Logging**
- [ ] اضافه کردن logging برای API calls خارجی
- [ ] monitoring وضعیت اتصال به API خارجی
- [ ] alert برای خطاهای مکرر
- [ ] metrics برای performance

### 🎯 **اولویت‌بندی:**
1. **High Priority:** تنظیمات اولیه، Service layer، API Routes
2. **Medium Priority:** Frontend components، State management
3. **Low Priority:** UX improvements، Monitoring، Documentation

### 📅 **زمان تخمینی:**
- **Phase 1 (Core):** 2-3 روز
- **Phase 2 (Frontend):** 2-3 روز  
- **Phase 3 (Polish):** 1-2 روز
- **Total:** 5-8 روز کاری

---
**آخرین به‌روزرسانی:** 25 مرداد 1404
**وضعیت:** پروژه کامل کار می‌کند، آماده برای اتصال به API قیمت‌های خارجی 