# ุฑุงูููุง ุฑูุน ูุดฺฉู Register ู ูุดุงูุฏู ูุงฺฏโูุง

## ๐ด ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู

### 1. ูุดฺฉู ูพูุฑุช Probeโูุง
- **Startup Probe**: ุฑู ูพูุฑุช **3000** ุชูุธู ุดุฏู โ
- **Liveness Probe**: ุฑู ูพูุฑุช **3000** ุชูุธู ุดุฏู โ
- **ุณุฑูุฑ ูุงูุน**: ุฑู ูพูุฑุช **3001** ุงุฌุฑุง ูโุดูุฏ โ

**ูุชุฌู:** Probeโูุง fail ูโุดููุฏ ู container restart ูโุดูุฏ!

### 2. ูุดฺฉู RAM
- **ูุตุฑู RAM ูพุฑูฺู**: 99% (1 GB / 2 GB) โ๏ธ
- ุงู ูโุชูุงูุฏ ุจุงุนุซ SIGTERM ู restart ุดูุฏ

### 3. ูุดฺฉู Register
- ุฎุทุง 500 ุฏุฑ `/api/auth/register`
- ูุงุฒ ุจู ุจุฑุฑุณ ูุงฺฏโูุง ุฏูู

---

## โ ุฑุงูโุญูโูุง

### ฺฏุงู 1: ุชุบุฑ ูพูุฑุช Probeโูุง ุจู 3001

ุฏุฑ ูพูู Runflare:

1. ุจู ุจุฎุด **"ุชุณุช ุณูุงูุช"** (Health Test) ุจุฑู
2. **Startup Probe** ุฑุง ูุฑุงุด ฺฉู:
   - **ูพูุฑุช**: `3000` โ `3001` ุชุบุฑ ุจุฏู
   - **ููุน**: `tcpSocket` (ูโุชูุงูุฏ ููุงู ุจูุงูุฏ)
   - **ุฏูุฑู**: `10s`
   - **ุฒูุงู ุตุจุฑ**: `2s`
   - **ุชุงุฎุฑ ุดุฑูุน**: `10s` (ุงูุฒุงุด ุจุฏู)
   - **failureThreshold**: `10` (ุงูุฒุงุด ุจุฏู)

3. **Liveness Probe** ุฑุง ูุฑุงุด ฺฉู:
   - **ูพูุฑุช**: `3000` โ `3001` ุชุบุฑ ุจุฏู
   - **ููุน**: `tcpSocket` (ูโุชูุงูุฏ ููุงู ุจูุงูุฏ)
   - **ุฏูุฑู**: `10s`
   - **ุฒูุงู ุตุจุฑ**: `2s`
   - **ุชุงุฎุฑ ุดุฑูุน**: `10s`
   - **failureThreshold**: `3`

**ุง ุจูุชุฑ ุงุณุช ุงุฒ HTTP Probe ุงุณุชูุงุฏู ฺฉู:**

ุจุฑุง **Startup Probe**:
- **ููุน**: `httpGet` (ุจู ุฌุง `tcpSocket`)
- **ุฑูุช**: `/health` ุง `/api/health`
- **ูพูุฑุช**: `3001`

ุจุฑุง **Liveness Probe**:
- **ููุน**: `httpGet`
- **ุฑูุช**: `/health` ุง `/api/health`
- **ูพูุฑุช**: `3001`

---

### ฺฏุงู 2: ุจุฑุฑุณ Environment Variables

ุฏุฑ ูพูู Runflareุ ุจู ุจุฎุด **"ุชูุธู ูุชุบุฑ ูุญุท"** ุจุฑู ู ูุทูุฆู ุดู:

```env
PORT=3001
HOST=0.0.0.0
NODE_ENV=production
DATABASE_URL=postgresql://...
JWT_SECRET=...
JWT_REFRESH_SECRET=...
```

---

### ฺฏุงู 3: ูุดุงูุฏู ูุงฺฏโูุง Register

#### ุฑูุด 1: ุงุฒ ูพูู Runflare (ุชูุตู ูโุดูุฏ)

1. ุฏุฑ ูพูู Runflareุ ุฑู ุขฺฉูู **"ูุดุงูุฏู ูุงฺฏ"** (View Logs) ฺฉูฺฉ ฺฉู
2. ุฏุฑ ููุชุฑ ูุงฺฏโูุงุ ุฏูุจุงู ุงู ูุชูโูุง ุจฺฏุฑุฏ:
   - `๐ [Register]`
   - `โ [Register]`
   - `โ [Register]`
3. ุง ุงุฒ ููุชุฑ ุฒูุงู ุงุณุชูุงุฏู ฺฉู (ูุซูุงู "15 ุฏููู ุงุฎุฑ")

#### ุฑูุด 2: ุงุฒ Terminal ุฏุฑ ูพูู Runflare

1. ุฏุฑ ูพูู Runflareุ ุฑู ุขฺฉูู **"ุชุฑููุงู"** (Terminal) ฺฉูฺฉ ฺฉู
2. ุงู ุฏุณุชูุฑุงุช ุฑุง ุงุฌุฑุง ฺฉู:

```bash
# ูุดุงูุฏู ูุงฺฏโูุง ุงุฎุฑ
tail -n 100 /var/log/app.log

# ุง ุงฺฏุฑ ูุงฺฏโูุง ุฏุฑ stdout ูุณุชูุฏ
# (ุฏุฑ Runflare ูุนูููุงู ูุงฺฏโูุง ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดููุฏ)
```

#### ุฑูุด 3: ุงุฒ ุฏุงุฎู Container (ุงฺฏุฑ ุฏุณุชุฑุณ ุฏุงุฑ)

```bash
# ูุดุงูุฏู ูุงฺฏโูุง process
ps aux | grep node

# ูุดุงูุฏู ูุงฺฏโูุง npm
cat /root/.npm/_logs/*.log | tail -n 50
```

---

### ฺฏุงู 4: ุชุณุช Register ู ูุดุงูุฏู ูุงฺฏโูุง

1. **ุงูู probeโูุง ุฑุง ุชุบุฑ ุจุฏู** (ฺฏุงู 1)
2. **ุณูพุณ ฺฉ ุฏุฑุฎูุงุณุช register ุจูุฑุณุช:**

```bash
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser999",
    "password": "Test1234",
    "confirmPassword": "Test1234",
    "firstName": "ุชุณุช",
    "lastName": "ฺฉุงุฑุจุฑ",
    "phoneNumber": "09123456793",
    "nationalId": "1234567894"
  }'
```

3. **ุจูุงูุงุตูู ุจู ูพูู Runflare ุจุฑู ู ูุงฺฏโูุง ุฑุง ุจุจู**

ูุงฺฏโูุง ฺฉู ุจุงุฏ ุจุจู:
```
๐ [Register] ========== ุดุฑูุน ุซุจุชโูุงู ==========
๐ [Register] ุฏุฑุฎูุงุณุช ุซุจุชโูุงู ุฏุฑุงูุช ุดุฏ
๐ [Register] ุฏุฑ ุญุงู ุฎูุงูุฏู body...
๐ [Register] Body ุฎูุงูุฏู ุดุฏ
๐ [Register] ุฏุฑ ุญุงู ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุฌุฏุฏ ุฏุฑ ุฏุชุงุจุณ...
๐ [Register] Step 1: ุงุฌุงุฏ ฺฉุงุฑุจุฑ...
โ [Register] ฺฉุงุฑุจุฑ ุงุฌุงุฏ ุดุฏ ุจุง ID: ...
๐ [Register] Step 2: ุงุฌุงุฏ ฺฉู ูพููโูุง ูพุดโูุฑุถ...
โ [Register] ฺฉู ูพููโูุง ุงุฌุงุฏ ุดุฏูุฏ: 2
๐ [Register] Step 3: ุงุฌุงุฏ ุชูุธูุงุช ฺฉุงุฑุจุฑ...
โ [Register] ุชูุธูุงุช ฺฉุงุฑุจุฑ ุงุฌุงุฏ ุดุฏ
๐ [Register] ุฏุฑ ุญุงู ุงุฌุงุฏ JWT tokens...
โ [Register] ========== ุซุจุชโูุงู ูููู ==========
```

**ุง ุงฺฏุฑ ุฎุทุง ุฑุฎ ุฏูุฏ:**
```
โ [Register] ========== ุฎุทุง ุฏุฑ ุซุจุชโูุงู ==========
โ [Register] ุฎุทุง ุฏุฑ ุซุจุชโูุงู: ...
๐ [Register] ููุน ุฎุทุง: ...
๐ [Register] ูพุงู ุฎุทุง: ...
๐ [Register] ฺฉุฏ ุฎุทุง: ...
๐ [Register] Prisma Meta: ...
```

---

## โ๏ธ ูุดฺฉู RAM

ูุตุฑู RAM ูพุฑูฺู **99%** ุงุณุช. ุงู ูโุชูุงูุฏ ุจุงุนุซ:
- SIGTERM signals
- Container restarts
- Timeout ุฏุฑ transactionโูุง

### ุฑุงูโุญูโูุง ูููุช:
1. **ุงูุฒุงุด RAM** (ุงฺฏุฑ ุงูฺฉุงู ุฏุงุฑุฏ)
2. **ฺฉุงูุด ุชุนุฏุงุฏ ุณุฑูุณโูุง ุฏฺฏุฑ** ุฏุฑ ูพุฑูฺู
3. **ุจูููโุณุงุฒ ฺฉุฏ** (ฺฉุงูุด memory leaks)

---

## ๐ ฺฺฉโูุณุช

- [ ] Startup Probe ูพูุฑุช ุฑุง ุจู 3001 ุชุบุฑ ุฏุงุฏู
- [ ] Liveness Probe ูพูุฑุช ุฑุง ุจู 3001 ุชุบุฑ ุฏุงุฏู
- [ ] Environment Variable `PORT=3001` ุชูุธู ุดุฏู ุงุณุช
- [ ] ฺฉ ุฏุฑุฎูุงุณุช register ูุฑุณุชุงุฏู
- [ ] ูุงฺฏโูุง register ุฑุง ุงุฒ ูพูู Runflare ุจุฑุฑุณ ฺฉุฑุฏู
- [ ] ูุงฺฏโูุง ุฎุทุง ุฑุง ฺฉูพ ฺฉุฑุฏู ู ุจุฑุง ุจุฑุฑุณ ูุฑุณุชุงุฏู

---

## ๐ ุงฺฏุฑ ูููุฒ ูุดฺฉู ุฏุงุฑ

1. **ูุงฺฏโูุง ฺฉุงูู register ุฑุง ฺฉูพ ฺฉู** (ุงุฒ ูพูู Runflare)
2. **ุฎุฑูุฌ ุงู ุฏุณุชูุฑุงุช ุฑุง ุจูุฑุณุช:**

```bash
# ุจุฑุฑุณ ูพูุฑุช
netstat -tlnp | grep 3001

# ุจุฑุฑุณ environment variables
echo $PORT
echo $HOST

# ุจุฑุฑุณ process
ps aux | grep node
```

3. **ุณูพุณ ูุงฺฏโูุง ู ุฎุฑูุฌโูุง ุฑุง ุจุฑุงู ุจูุฑุณุช** ุชุง ุจุชูุงูู ูุดฺฉู ุฑุง ุฏููโุชุฑ ุดูุงุณุง ฺฉูู.

