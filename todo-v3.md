# TODO v3 - تغییرات مورد نیاز بر اساس بازخورد

## 1. اصلاح مشکل قیمت‌گذاری در بازار

### مشکل:
- در بخش قیمت‌های داخلی، قیمت خرید و فروش جابه‌جا نمایش داده می‌شود
- قیمت خرید همیشه باید بالاتر از قیمت فروش باشد

### تغییرات مورد نیاز:
- [ ] بررسی و اصلاح منطق نمایش قیمت‌ها در `PriceDisplayCard.tsx`
- [ ] اطمینان از اینکه قیمت خرید > قیمت فروش
- [ ] تست و اعتبارسنجی نمایش صحیح قیمت‌ها

### فایل‌های مربوطه:
- `app/components/Dashboard/PriceDisplayCard.tsx`
- `app/market/page.tsx`
- `app/components/Dashboard/ExternalPricesList.tsx`

---

## 2. محاسبه صحیح قیمت طلای 18 عیار

### مشکل:
- قیمت نقد خرد (مظنه) باید تقسیم بر 4.3318 شود تا قیمت هر گرم طلای 18 عیار محاسبه شود
- این محاسبه در حال حاضر انجام نمی‌شود

### تغییرات مورد نیاز:
- [ ] اضافه کردن محاسبه خودکار قیمت طلای 18 عیار
- [ ] استفاده از فرمول: `قیمت طلای 18 عیار = قیمت نقد خرد / 4.3318`
- [ ] نمایش قیمت محاسبه شده در رابط کاربری

### فایل‌های مربوطه:
- `app/lib/externalPriceService.ts`
- `app/api/prices/external/route.ts`
- `app/components/Dashboard/ExternalPricesList.tsx`

---

## 3. غیرفعال کردن آدرس تحویل در تحویل فیزیکی

### مشکل:
- در بخش تحویل فیزیکی، آدرس تحویل باید خاموش باشد
- فقط تاریخ تحویل و زمان تحویل باید باقی بماند

### تغییرات مورد نیاز:
- [ ] حذف فیلد آدرس تحویل از فرم
- [ ] حذف validation مربوط به آدرس
- [ ] به‌روزرسانی API برای عدم نیاز به آدرس
- [ ] تغییر متن صفحه به "تحویل در فروشگاه"

### فایل‌های مربوطه:
- `app/components/Trading/PhysicalDelivery.tsx`
- `app/delivery/page.tsx`
- `app/api/delivery/request/route.ts`

---

## 4. بهبود سیستم انتقال طلا با کد تایید

### مشکل:
- انتقال طلا نیاز به کد تایید دارد
- باید مثل یک بار رمز عمل کند

### تغییرات مورد نیاز:
- [ ] اضافه کردن سیستم OTP برای انتقال طلا
- [ ] ارسال کد تایید به شماره تلفن
- [ ] اعتبارسنجی کد قبل از انجام انتقال
- [ ] اضافه کردن تایمر برای کد تایید

### فایل‌های مربوطه:
- `app/transfer/page.tsx`
- `app/api/transfer/route.ts`
- `app/api/sms/send/route.ts`
- `app/api/auth/verify-otp/route.ts`

---

## 5. بهبود نمایش کیف پول - نمایش موجودی سکه‌ها

### مشکل:
- کیف پول باید موجودی سکه‌ها را جداگانه نمایش دهد
- نمایش موجودی نیم سکه، ربع سکه، و تمام سکه

### تغییرات مورد نیاز:
- [ ] اضافه کردن فیلدهای موجودی سکه‌ها در دیتابیس
- [ ] به‌روزرسانی `WalletSummary.tsx` برای نمایش سکه‌ها
- [ ] اضافه کردن منطق محاسبه موجودی سکه‌ها
- [ ] نمایش فقط سکه‌هایی که موجودی دارند (نه صفر)

### فایل‌های مربوطه:
- `prisma/schema.prisma` (اضافه کردن فیلدهای سکه)
- `app/components/Dashboard/WalletSummary.tsx`
- `app/api/wallet/balance/route.ts`

---

## 6. کوچک کردن و بهبود طراحی کیف پول

### مشکل:
- کیف پول خیلی بزرگ است
- نیاز به طراحی فشرده‌تر و بهتر

### تغییرات مورد نیاز:
- [ ] کاهش اندازه کارت‌های کیف پول
- [ ] بهبود layout و spacing
- [ ] طراحی فشرده‌تر برای نمایش اطلاعات
- [ ] بهبود responsive design

### فایل‌های مربوطه:
- `app/components/Dashboard/WalletSummary.tsx`
- `app/components/Wallet/WalletBalance.tsx`

---

## 7. اصلاح کارمزد تحویل

### مشکل:
- کارمزد تحویل 2% از وزن است ولی به تومان محاسبه می‌شود
- باید بر اساس وزن محاسبه شود

### تغییرات مورد نیاز:
- [ ] اصلاح محاسبه کارمزد تحویل
- [ ] محاسبه بر اساس وزن طلا
- [ ] نمایش صحیح کارمزد در رابط کاربری

### فایل‌های مربوطه:
- `app/components/Trading/PhysicalDelivery.tsx`
- `app/api/delivery/request/route.ts`

---

## 8. بهبود سیستم جستجوی کاربر در انتقال

### مشکل:
- سیستم جستجوی کاربر با شماره تلفن کار می‌کند
- نیاز به بهبود امنیت و اعتبارسنجی

### تغییرات مورد نیاز:
- [ ] بهبود API جستجوی کاربر
- [ ] اضافه کردن اعتبارسنجی بیشتر
- [ ] بهبود UI برای نمایش نتایج جستجو

### فایل‌های مربوطه:
- `app/api/users/search/route.ts`
- `app/transfer/page.tsx`

---

## 9. تست و اعتبارسنجی

### تغییرات مورد نیاز:
- [ ] تست تمام تغییرات
- [ ] اعتبارسنجی محاسبات قیمت
- [ ] تست سیستم انتقال با OTP
- [ ] تست نمایش کیف پول
- [ ] تست تحویل فیزیکی

---

## 10. مستندسازی

### تغییرات مورد نیاز:
- [ ] به‌روزرسانی API_DOCUMENTATION.md
- [ ] مستندسازی تغییرات جدید
- [ ] راهنمای استفاده از ویژگی‌های جدید

---

## اولویت‌بندی:

### اولویت بالا:
1. اصلاح قیمت‌گذاری در بازار
2. محاسبه صحیح قیمت طلای 18 عیار
3. غیرفعال کردن آدرس تحویل

### اولویت متوسط:
4. بهبود نمایش کیف پول
5. کوچک کردن طراحی کیف پول
6. اصلاح کارمزد تحویل

### اولویت پایین:
7. بهبود سیستم انتقال با OTP
8. بهبود سیستم جستجوی کاربر
9. تست و اعتبارسنجی
10. مستندسازی

---

## نکات مهم:

- **تقسیم طلای 18 عیار**: استفاده از عدد 4.3318 برای محاسبه
- **امنیت**: تمام تغییرات باید با در نظر گیری امنیت انجام شود
- **UX**: بهبود تجربه کاربری در تمام تغییرات
- **Performance**: بهینه‌سازی عملکرد در تغییرات
- **Responsive**: اطمینان از responsive بودن تمام تغییرات
