# TODO v3 – اصلاحات پنل ادمین

این سند صرفاً برای پوشش نیازهای تازه اعلام‌شده‌ی پنل ادمین است. تمام موارد زیر باید بررسی، طراحی و پیاده‌سازی شوند. برای هر آیتم پس از اتمام، تیک مربوطه را بزنید.

---

## 1. پایداری و به‌روزرسانی خودکار
- [ ] **رفع باگ خالی شدن داده بعد از چند رفرش:** ریشه‌یابی مشکل session/token و جلوگیری از نیاز به لاگین مجدد پس از Refresh‌های متوالی.
- [ ] **Polling / Realtime برای تب‌های «کاربران» و «سفارشات»:** داده‌ها بدون نیاز به رفرش دستی به‌روزرسانی شوند (interval یا WebSocket).

## 2. مدیریت کاربران و کیف پول
- [ ] **فعال‌سازی کامل دکمه «شارژ»:** قابلیت شارژ ریالی، طلایی و انواع سکه برای هر کاربر، با امکان تعیین مقدار دلخواه و ثبت توضیح.
- [ ] **نمایش جداکننده هزارگان در کل فرم‌های ورود عدد (کلاینت):** مخصوصاً فرم‌های شارژ ریالی و سایر ورودی‌های عددی.
- [ ] **فرایند واریز معلق تا تایید ادمین:** پس از واریز کاربر، موجودی کیف پول قبل از تایید ادمین افزایش نیابد و پیغام «در انتظار تایید رادیزگلد» نمایش داده شود.
- [ ] **تضمین استقلال هر تراکنش شارژ/برداشت:** تایید یک تراکنش نباید خودکار به تراکنش‌های بعدی سرایت کند؛ هر رکورد باید وضعیت جداگانه داشته باشد.
- [ ] **نمایش اطلاعات کامل تراکنش در تب کاربران:** برای هر تراکنش، مبلغ همان تراکنش + موجودی کل پس از آن نمایش داده شود تا تفکیک و ترتیب تاییدها مشخص باشد.
- [ ] **بررسی و نمایش شماره شبا هنگام برداشت:** پیش از تایید برداشت، شبا با نام دارنده مطابقت داده شود و در پنل ادمین قابل مشاهده باشد.
- [ ] **امکان تست سناریوهای تحویل/انتقال حتی با موجودی صفر:** فراهم کردن راهکاری (مثلاً داده تست یا شارژ اولیه) تا ادمین بتواند فرآیندهای تحویل طلا و سکه را بررسی کند.

## 3. سفارش‌ها و کنترل دستی معاملات
- [x] **نمایش وزن سفارش در لیست خرید/فروش:** علاوه بر مبلغ ریالی، وزن دقیق طلا/سکه خریداری یا فروخته‌شده نشان داده شود.
- [x] **نمایش همزمان گرم و مثقال:** در کنار وزن به گرم، معادل مثقال (براساس مظنه روز) برای هر سفارش خرید/فروش نمایش داده شود تا ادمین بدون محاسبه دستی تصمیم بگیرد.
- [x] **برجسته‌سازی وزن/مظنه:** اندازه فونت و چیدمان بخش وزن/مظنه بزرگ‌تر از کارمزد باشد تا سریع‌تر دیده شود؛ کارمزد می‌تواند با فونت کوچکتر زیر آن بیاید.
- [x] **محاسبه و نمایش «مظنه نهایی» (قیمت هر مثقال + کارمزد):** مبلغ سفارش تقسیم بر وزن گرم → قیمت هر گرم → ضربدر ۴.۳۳۳ * ۱۸ برای نمایش مظنه تمام‌شده. این مقدار در کنار وزن نشان داده شود تا ادمین بدون ماشین‌حساب متوجه نرخ معامله شود.
- [x] **بهینه‌سازی گزینه‌های وضعیت سفارش:** در UI فقط سه گزینه «تایید شد»، «منقضی شد»، «عدم تایید» نمایش داده شود (با نگاشت لازم به enumهای فعلی).
- [ ] **پنجره تایمر ۱۸۰ ثانیه‌ای هنگام ثبت سفارش:** پیام «رادیزگلد در حال انجام معامله شماست» + شمارش معکوس برای کاربر و هشدار واضح برای ادمین.
- [ ] **سناریوی ۱ – عدم اقدام در ۱۸۰ ثانیه:** پس از اتمام تایمر، وضعیت به «منقضی شد» تغییر کند، هیچ برداشت/واریزی انجام نشود و علت به کاربر نمایش داده شود.
- [ ] **سناریوی ۲ – تایید در بازه:** با تایید ادمین، موجودی ریالی/وزنی طبق سفارش تنظیم و تراکنش‌ها ثبت شوند.
- [ ] **سناریوی ۳ – عدم تایید:** ادمین بتواند سفارش را با دلایل پیش‌فرض (نوسان قیمت، بازار بسته، معامله انجام نشد و ...) یا متن سفارشی رد کند و پیام به کاربر برسد.
- [ ] **اعلان فوری به ادمین هنگام سفارش جدید:** تضمین شود درخواست خرید/فروش بلافاصله با پیام/صدا/Badge و شمارنده به ادمین برسد (در ادامه کار todo-v2، اما تمرکز روی تکمیل سناریوهای بالا).
- [x] **حذف اسکرول افقی در جدول سفارشات:** با کوتاه‌سازی عناوین (مثلاً «خ» برای خرید، «ف» برای فروش) یا کوچک‌تر کردن شماره سفارش، جدول در عرض صفحه فیت شود و نیاز به کشیدن scrollbar نباشد.

## 4. حالت آنلاین/آفلاین معاملات
- [x] **سوییچ «مدیر آفلاین است»:** امکانی برای ادمین جهت توقف موقت ثبت سفارش خرید، فروش، انتقال و تحویل فیزیکی. هنگام آفلاین بودن، پیام مناسب (مثلاً «مدیر آفلاین است؛ معاملات موقتاً متوقف شده‌اند») به کاربران نمایش داده شود.
- [x] **عدم توقف واریز/برداشت:** حتی در حالت آفلاین، کاربران بتوانند درخواست واریز/برداشت ثبت کنند اما وضعیت آن‌ها تا تایید ادمین «در انتظار تایید» بماند.
- [x] **بازگشت سریع به حالت آنلاین:** با فعال‌سازی مجدد، همه فرم‌های سفارش دوباره در دسترس شوند و Countdown/Notificationها عادی کار کنند.

## 5. تجربه کاربری ادمین
- [ ] **به‌روزرسانی زنده پس از عملیات شارژ/تایید:** پس از هر اقدام (تایید تراکنش، شارژ، رد سفارش)، جدول‌ها بدون رفرش دستی تازه شوند.
- [ ] **بازطراحی پیام‌های وضعیت:** توضیحات واضح برای هر وضعیت (تایید شد، منقضی، عدم تایید) در هر دو سمت کاربر و ادمین نمایش داده شود.

## 6. تست و تضمین کیفیت
- [ ] **تست سناریوهای ترکیبی (شارژ معلق + سفارش):** اطمینان از اینکه تایید یا رد تراکنش روی سفارش‌های هم‌زمان تاثیر ناخواسته ندارد.
- [ ] **تست Load سبک روی رفرش مداوم پنل:** بررسی اینکه polling/real-time جدید باعث سنگینی یا logout ناگهانی نشود.

---

> یادآوری: تمرکز این نسخه از TODO فقط روی رفع مشکلات و بهبودهای پنل ادمین است؛ پیاده‌سازی باید در راستای تجربه کاری که کارفرما شرح داده انجام شود.

