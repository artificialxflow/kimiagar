# ุจุฑุฑุณ ูุถุนุช Container ู ุฑูุน 502

## โ ูุถุนุช ูุนู (ุงุฒ ุฏุณุชูุฑุงุช)

- โ Node.js process ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช (PID 19)
- โ Health check ฺฉุงุฑ ูโฺฉูุฏ
- โ ุฏุชุงุจุณ ูุชุตู ุงุณุช
- โ Migrationโูุง ุงุนูุงู ุดุฏูโุงูุฏ

## ๐ ุจุฑุฑุณโูุง ูุงุฒู

### 1. ุจุฑุฑุณ ุงูฺฉู ุขุง Container Restart ูโุดูุฏ

ุงุฒ terminal ุฏุฑ ูพูู Runflare:

```bash
# ุจุฑุฑุณ PID - ุงฺฏุฑ ุชุบุฑ ฺฉุฑุฏ ุนู restart ุดุฏู
ps aux | grep node

# ุจุฑุฑุณ uptime
ps -p 19 -o etime

# ุจุฑุฑุณ ูุงฺฏโูุง restart
# (ุงุฒ ูพูู Runflare โ ูุดุงูุฏู ูุงฺฏ)
```

**ุงฺฏุฑ PID ุชุบุฑ ฺฉุฑุฏ ุง uptime ฺฉู ุงุณุช** โ ุนู container restart ูโุดูุฏ

---

### 2. ุจุฑุฑุณ Probeโูุง

ุฏุฑ ูพูู Runflare:
1. ุจู ุจุฎุด **"ุชุณุช ุณูุงูุช"** ุจุฑู
2. **Startup Probe** ุฑุง ุจุฑุฑุณ ฺฉู:
   - ูพูุฑุช ุจุงุฏ **3001** ุจุงุดุฏ (ูู 3000)
3. **Liveness Probe** ุฑุง ุจุฑุฑุณ ฺฉู:
   - ูพูุฑุช ุจุงุฏ **3001** ุจุงุดุฏ (ูู 3000)

**ุงฺฏุฑ ูููุฒ 3000 ุงุณุช** โ ุชุบุฑ ุจุฏู ุจู 3001

---

### 3. ุจุฑุฑุณ Nginx Configuration

ูุดฺฉู 502 ูุนูููุงู ุงุฒ ุงู ุงุณุช ฺฉู:
- Nginx ุจู ูพูุฑุช 3000 ุงุดุงุฑู ูโฺฉูุฏ (ุงุดุชุจุงู)
- ุง ุจู ูพูุฑุช 3001 ุงุดุงุฑู ูโฺฉูุฏ ุงูุง container restart ูโุดูุฏ

**ุฑุงูโุญู:**
1. Probeโูุง ุฑุง ุจู 3001 ุชุบุฑ ุจุฏู
2. ฺูุฏ ุฏููู ุตุจุฑ ฺฉู
3. ุตูุญู ุฑุง refresh ฺฉู

---

### 4. ุชุณุช ูุณุชูู ุงุฒ ุฏุงุฎู Container

ุงุฒ terminal:

```bash
# ุชุณุช health check
curl http://localhost:3001/api/health

# ุชุณุช register (ุจุฑุง ุจุฑุฑุณ ูุงฺฏโูุง)
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser999",
    "password": "Test1234",
    "confirmPassword": "Test1234",
    "firstName": "ุชุณุช",
    "lastName": "ฺฉุงุฑุจุฑ",
    "phoneNumber": "09123456794",
    "nationalId": "1234567895"
  }'
```

---

## ๐ฏ ุงูุฏุงูุงุช ููุฑ

### ฺฏุงู 1: ุชุบุฑ Probeโูุง (ุงฺฏุฑ ูููุฒ ูฺฉุฑุฏ)

ุฏุฑ ูพูู Runflare โ ุชุณุช ุณูุงูุช:
- Startup Probe: ูพูุฑุช **3001**
- Liveness Probe: ูพูุฑุช **3001**

### ฺฏุงู 2: ุตุจุฑ ฺฉุฑุฏู

2-3 ุฏููู ุตุจุฑ ฺฉู ุชุง ุชุบุฑุงุช ุงุนูุงู ุดูุฏ.

### ฺฏุงู 3: ุชุณุช ุงุฒ ูุฑูุฑฺฏุฑ

ุจู `radizgold.ir` ุจุฑู ู ุจุจู ุขุง 502 ุฑูุน ุดุฏู ุง ูู.

---

## ๐ง ุงฺฏุฑ ูููุฒ 502 ูโุจู

### ุจุฑุฑุณ 1: Container Restart

ุงุฒ ูพูู Runflare โ ูุดุงูุฏู ูุงฺฏ:
- ุฏูุจุงู `SIGTERM` ุจฺฏุฑุฏ
- ุฏูุจุงู `Startup probe failed` ุจฺฏุฑุฏ
- ุงฺฏุฑ ุงู ูพุงูโูุง ุฑุง ุฏุฏ โ Probeโูุง ุฑุง ุชุบุฑ ุจุฏู

### ุจุฑุฑุณ 2: Nginx Upstream

ุงฺฏุฑ ุฏุณุชุฑุณ ุจู ุชูุธูุงุช Nginx ุฏุงุฑ:
- ูุทูุฆู ุดู ฺฉู upstream ุจู `localhost:3001` ุงุดุงุฑู ูโฺฉูุฏ

### ุจุฑุฑุณ 3: Domain Configuration

ุฏุฑ ูพูู Runflare:
- ุจุฑุฑุณ ฺฉู ฺฉู domain ุจู ุฏุฑุณุช ุชูุธู ุดุฏู ุงุณุช
- ุจุฑุฑุณ ฺฉู ฺฉู SSL certificate ูุนุชุจุฑ ุงุณุช

---

## ๐ ฺฺฉโูุณุช ููุง

- [ ] Probeโูุง ุฑู ูพูุฑุช 3001 ูุณุชูุฏ
- [ ] Environment Variable `PORT=3001` ุชูุธู ุดุฏู ุงุณุช
- [ ] 2-3 ุฏููู ุตุจุฑ ฺฉุฑุฏู
- [ ] ุงุฒ ูุฑูุฑฺฏุฑ ุชุณุช ฺฉุฑุฏู (ูู ููุท ุงุฒ terminal)
- [ ] ุงฺฏุฑ ูููุฒ 502 ูโุจูุ ูุงฺฏโูุง restart ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู

